<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Dashboard</title>
</h:head>
<h:body>
    <h:form id="mainForm">
        <p:growl id="growl" showDetail="true" />

        <p:poll interval="1" update="@form" listener="#{dashboardController.loadDashboardData}" />

        <h2>Call Center Agents</h2>
        <p:dataTable id="agentsTable" value="#{dashboardController.agents}" var="agent">
            <p:column headerText="ID">
                <h:outputText value="#{agent.id}" />
            </p:column>
            <p:column headerText="Name">
                <h:outputText value="#{agent.name}" />
            </p:column>
            <p:column headerText="Status">
                <h:outputText value="#{agent.status}" />
            </p:column>
            <p:column headerText="Status Time">
                <h:outputText value="#{agent.statusTime}" />
            </p:column>
            <p:column headerText="Total Calls">
                <h:outputText value="#{agent.totalNumberOfCalls}" />
            </p:column>
            <p:column>
                <p:commandButton value="Toggle Status" action="#{dashboardController.toggleAgentStatus(agent.id)}" update=":mainForm:agentsTable"
                                 disabled="#{agent.status == 'ON_CALL'}">
                    <p:ajax update=":mainForm:agentsTable" />
                </p:commandButton>
            </p:column>
        </p:dataTable>

        <h2>Ongoing Calls</h2>
        <p:dataTable id="callsTable" value="#{dashboardController.calls}" var="call">
            <p:column headerText="Call ID">
                <h:outputText value="#{call.callID}" />
            </p:column>
            <p:column headerText="Agent ID">
                <h:outputText value="#{call.agentID}" />
            </p:column>
            <p:column headerText="Start Time">
                <h:outputText value="#{call.startTime}" />
            </p:column>
            <p:column headerText="End Time">
                <h:outputText value="#{call.endTime}" />
            </p:column>
            <p:column headerText="Duration">
                <h:outputText value="#{call.formattedDuration}" />
            </p:column>
        </p:dataTable>
    </h:form>
</h:body>
</html>
